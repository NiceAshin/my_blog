(window.webpackJsonp=window.webpackJsonp||[]).push([[133],{549:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"nginx的静态资源404问题解决"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx的静态资源404问题解决"}},[t._v("#")]),t._v(" Nginx的静态资源404问题解决")]),t._v(" "),s("blockquote",[s("p",[t._v("预计阅读时间：6 分钟")])]),t._v(" "),s("blockquote",[s("p",[s("strong",[t._v("先看日志先看日志!")])])]),t._v(" "),s("h3",{attrs:{id:"需求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#需求"}},[t._v("#")]),t._v(" 需求")]),t._v(" "),s("p",[t._v("部署一套网站, 网站的html与css, js 和图片这些静态资源分别在不同目录中.")]),t._v(" "),s("p",[t._v("结构如下:")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("├─htmlas\n│  └─web         # html文件位置\n│  \t ├─product\t # html文件夹\n|    ├─news \t # html文件夹\n|    └─index.html\n├─upload\t\t# 上传文件所在位置\n├─static\t\t\n│  ├─css\t\t\n│  ├─image\t\t\n   └─js         \n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br")])]),s("h3",{attrs:{id:"nginx配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx配置"}},[t._v("#")]),t._v(" nginx配置")]),t._v(" "),s("p",[t._v("在我的本地测试的配置如下")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("    server {\n        listen       80;\n        server_name  localhost;\n\t\t\n\t\tlocation /html/web/ {\n            root   E:/webapp/html/web/;\n        }\n\t\tlocation  /static/ {\n\t\t\troot E:/webapp/static/;\n\t\t}\n\t\t\t\n\t\tlocation  /upload/ {\n\t\t\troot E:/webapp/upload/;\n\t\t}\n\n\t\tlocation  /template/ {\n\t\t\troot E:/webapp/template/;\n\t\t}\n\n\t\tlocation  /test/ {\n\t\t\troot E:/webapp/upload/;\n\t\t}\n         location / {\n            root   E:/webapp/html/web/;\n            index index.html;\n        }\n    }\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br")])]),s("h3",{attrs:{id:"问题描述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#问题描述"}},[t._v("#")]),t._v(" 问题描述")]),t._v(" "),s("p",[t._v("当我访问某个静态文件时, 比如http://localhost/upload/te.pnp.   nginx返回404,  其他静态文件同样的404除了index.html")]),t._v(" "),s("h3",{attrs:{id:"解决"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解决"}},[t._v("#")]),t._v(" 解决")]),t._v(" "),s("p",[t._v("先看日志error.log")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('2021/07/29 10:44:52 [notice] 16676#17292: signal process started\n2021/07/29 10:45:05 [error] 16660#9948: *1 CreateFile() "E:/webapp/html/web/update/te.png" failed (3: The system cannot find the path specified), client: 127.0.0.1, server: localhost, request: "GET /update/te.png HTTP/1.1", host: "localhost:801"\n2021/07/29 10:45:06 [error] 16660#9948: *1 CreateFile() "E:/webapp/html/web/favicon.ico" failed (2: The system cannot find the file specified), client: 127.0.0.1, server: localhost, request: "GET /favicon.ico HTTP/1.1", host: "localhost:801", referrer: "http://localhost:801/update/te.png"\n2021/07/29 10:45:14 [notice] 19112#17880: signal process started\n2021/07/29 10:47:35 [error] 17272#2072: *1 CreateFile() "E:/webapp/html/web/update/te.png" failed (3: The system cannot find the path specified), client: 127.0.0.1, server: localhost, request: "GET /update/te.png HTTP/1.1", host: "localhost"\n')])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("p",[t._v("日志发现nginx去E:/webapp/html/web/update/下面去寻找te.png了.  它没有把http://localhost/upload/te.pnp中的http://localhost/upload替换为E:/webapp/upload/,   所以必然会404.")]),t._v(" "),s("p",[t._v("查阅资料发现nginx还提供了alias")]),t._v(" "),s("p",[t._v("alias与root的区别:")]),t._v(" "),s("p",[t._v("alais配置的目录nginx会处理为   "),s("strong",[t._v("alais路径替换localtion路径")])]),t._v(" "),s("blockquote",[s("p",[t._v("alais配置的目录后边要加 /")])]),t._v(" "),s("p",[t._v("root配置的目录nginx会处理为    "),s("strong",[t._v("root路径 + location路径")])]),t._v(" "),s("p",[t._v("最后调整配置如下")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("    server {\n        listen       80;\n        server_name  localhost;\n\t\t\n\t\tlocation /html/web/ {\n            alias   E:/webapp/html/web/;\n        }\n\t\tlocation  /static/ {\n\t\t\talias E:/webapp/static/;\n\t\t}\n\t\t\t\n\t\tlocation  /upload/ {\n\t\t\talias E:/webapp/upload/;\n\t\t}\n\n\t\tlocation  /template/ {\n\t\t\talias E:/webapp/template/;\n\t\t}\n\n\t\tlocation  /test/ {\n\t\t\talias E:/webapp/upload/;\n\t\t}\n         location / {\n            root   E:/webapp/html/web/;\n            index index.html;\n        }\n    }\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br")])]),s("p",[t._v("访问成功")])])}),[],!1,null,null,null);s.default=e.exports}}]);