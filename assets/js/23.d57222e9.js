(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{438:function(s,a,t){"use strict";t.r(a);var e=t(2),r=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"kubernetes-持久化存储-pv-与-pvc-全面解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes-持久化存储-pv-与-pvc-全面解析"}},[s._v("#")]),s._v(" Kubernetes 持久化存储：PV 与 PVC 全面解析")]),s._v(" "),a("blockquote",[a("p",[s._v("预计阅读时间：9 分钟")])]),s._v(" "),a("h2",{attrs:{id:"_1-来源与参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-来源与参考"}},[s._v("#")]),s._v(" 1. 来源与参考")]),s._v(" "),a("p",[s._v("结合官方存储卷文档、CNCF Storage WG 设计提案、Ceph/Rook、Longhorn 等开源存储项目的实践案例，总结在混合云集群中构建有状态服务存储的经验。")]),s._v(" "),a("h2",{attrs:{id:"_2-当前挑战"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-当前挑战"}},[s._v("#")]),s._v(" 2. 当前挑战")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("多环境一致性")]),s._v("：开发、测试、生产集群的存储类型不同，导致 YAML 频繁改动。")]),s._v(" "),a("li",[a("strong",[s._v("容量与性能不可见")]),s._v("：缺少监控与配额策略，轻则影响稳定性，重则导致数据库宕机。")]),s._v(" "),a("li",[a("strong",[s._v("备份与恢复流程复杂")]),s._v("：无统一工具链，事故时难以快速恢复。")])]),s._v(" "),a("h2",{attrs:{id:"_3-核心概念回顾"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-核心概念回顾"}},[s._v("#")]),s._v(" 3. 核心概念回顾")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("PersistentVolume (PV)")]),s._v("：集群中的存储资源抽象，由管理员或动态供应器创建。")]),s._v(" "),a("li",[a("strong",[s._v("PersistentVolumeClaim (PVC)")]),s._v("：用户对存储的申请，指定容量、访问模式、存储类等。")]),s._v(" "),a("li",[a("strong",[s._v("StorageClass")]),s._v("：描述存储类型与供应器参数，实现动态供给。")])]),s._v(" "),a("div",{staticClass:"language-mermaid line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-mermaid"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("graph")]),s._v(" TD\n    User "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("--\x3e")]),a("span",{pre:!0,attrs:{class:"token label property"}},[s._v("|create|")]),s._v(" PVC\n    PVC "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("--\x3e")]),a("span",{pre:!0,attrs:{class:"token label property"}},[s._v("|bind|")]),s._v(" PV\n    PV "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("--\x3e")]),a("span",{pre:!0,attrs:{class:"token label property"}},[s._v("|provisioner|")]),s._v(" StorageClass\n    StorageClass "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("--\x3e")]),a("span",{pre:!0,attrs:{class:"token label property"}},[s._v("|backend|")]),s._v(" StorageSystem"),a("span",{pre:!0,attrs:{class:"token text string"}},[s._v("[(存储系统)]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"_4-动态供给示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-动态供给示例"}},[s._v("#")]),s._v(" 4. 动态供给示例")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" storage.k8s.io/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" StorageClass\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" fast"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ssd\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("provisioner")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kubernetes.io/aws"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ebs\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("parameters")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" gp3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("reclaimPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Retain\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("allowVolumeExpansion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" PersistentVolumeClaim\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("data\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("accessModes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ReadWriteOnce\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storageClassName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" fast"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ssd\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("requests")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 200Gi\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("allowVolumeExpansion")]),s._v(" 允许在线扩容。")]),s._v(" "),a("li",[a("code",[s._v("reclaimPolicy: Retain")]),s._v(" 在删除 PVC 后保留数据，需手动清理。")])]),s._v(" "),a("h2",{attrs:{id:"_5-多租户存储策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-多租户存储策略"}},[s._v("#")]),s._v(" 5. 多租户存储策略")]),s._v(" "),a("ol",[a("li",[a("strong",[s._v("命名空间级别配额")]),s._v("：通过 "),a("code",[s._v("ResourceQuota")]),s._v(" 限制总存储申请。")]),s._v(" "),a("li",[a("strong",[s._v("StorageClass 隔离")]),s._v("：不同业务线使用独立的 StorageClass，后台对应不同 Ceph Pool 或云磁盘类型。")]),s._v(" "),a("li",[a("strong",[s._v("CSI 驱动权限控制")]),s._v("：为每个租户配置独立凭证，避免跨租户访问。")])]),s._v(" "),a("h2",{attrs:{id:"_6-数据保护与备份"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-数据保护与备份"}},[s._v("#")]),s._v(" 6. 数据保护与备份")]),s._v(" "),a("ul",[a("li",[s._v("集成 "),a("a",{attrs:{href:"https://velero.io",target:"_blank",rel:"noopener noreferrer"}},[s._v("Velero"),a("OutboundLink")],1),s._v(" 实现增量备份与跨集群迁移。")]),s._v(" "),a("li",[s._v("对数据库类工作负载，结合 "),a("code",[s._v("VolumeSnapshot")]),s._v(" 创建一致性快照。")]),s._v(" "),a("li",[s._v("通过 "),a("code",[s._v("CronJob")]),s._v(" 调度，定期校验备份有效性。")])]),s._v(" "),a("h2",{attrs:{id:"_7-监控与运维"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-监控与运维"}},[s._v("#")]),s._v(" 7. 监控与运维")]),s._v(" "),a("ul",[a("li",[s._v("使用 Prometheus + Grafana 监控 PVC 使用率、IOPS、吞吐。")]),s._v(" "),a("li",[s._v("利用 "),a("code",[s._v("kubectl describe pvc")]),s._v("、"),a("code",[s._v("kubectl get pvc -A")]),s._v(" 定期巡检绑定状态。")]),s._v(" "),a("li",[s._v("配置告警：当 PVC 使用率 > 80% 时提醒扩容。")])]),s._v(" "),a("h2",{attrs:{id:"_8-业务落地案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-业务落地案例"}},[s._v("#")]),s._v(" 8. 业务落地案例")]),s._v(" "),a("p",[s._v("在券商实时行情系统中：")]),s._v(" "),a("ul",[a("li",[s._v("使用 Rook 管理 Ceph 集群，定义 "),a("code",[s._v("replicated")]),s._v(" 与 "),a("code",[s._v("erasure-coded")]),s._v(" 两类 StorageClass。")]),s._v(" "),a("li",[s._v("将撮合服务的状态数据绑定至高性能 SSD，历史归档使用容量型存储。")]),s._v(" "),a("li",[s._v("借助 VolumeSnapshot 在升级前创建快照，若升级失败可快速回滚。")])]),s._v(" "),a("h2",{attrs:{id:"_9-常见故障排查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-常见故障排查"}},[s._v("#")]),s._v(" 9. 常见故障排查")]),s._v(" "),a("ul",[a("li",[s._v("PVC 长时间处于 "),a("code",[s._v("Pending")]),s._v("：检查 StorageClass 是否存在、CSI 控制器日志。")]),s._v(" "),a("li",[s._v("Pod 无法挂载：查看节点 CSI 插件日志、确认节点权限。")]),s._v(" "),a("li",[s._v("数据未清理：对于 "),a("code",[s._v("Retain")]),s._v(" 策略，需要手动删除底层存储卷。")])]),s._v(" "),a("h2",{attrs:{id:"_10-进一步阅读"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-进一步阅读"}},[s._v("#")]),s._v(" 10. 进一步阅读")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://kubernetes.io/docs/concepts/storage/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Kubernetes Storage Concepts"),a("OutboundLink")],1)]),s._v(" "),a("li",[s._v("[CNCF Storage WG 白皮书]")]),s._v(" "),a("li",[s._v("[Rook 官方文档]")])]),s._v(" "),a("p",[s._v("通过标准化 PV/PVC 策略，团队能够在 Kubernetes 中稳定托管数据库、消息队列等有状态服务，支撑关键业务持续运行。")])])}),[],!1,null,null,null);a.default=r.exports}}]);