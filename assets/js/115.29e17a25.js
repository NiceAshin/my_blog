(window.webpackJsonp=window.webpackJsonp||[]).push([[115],{533:function(a,s,t){"use strict";t.r(s);var e=t(2),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"微服务治理与网关架构全景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#微服务治理与网关架构全景"}},[a._v("#")]),a._v(" 微服务治理与网关架构全景")]),a._v(" "),s("blockquote",[s("p",[a._v("预计阅读时间：9 分钟")])]),a._v(" "),s("h2",{attrs:{id:"_1-资料来源"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-资料来源"}},[a._v("#")]),a._v(" 1. 资料来源")]),a._v(" "),s("p",[a._v("参考 Netflix、蚂蚁金服与滴滴的服务治理分享，结合 CNCF Service Mesh 文档，以及我们在支付清结算平台建设统一网关与治理中心的经验。")]),a._v(" "),s("h2",{attrs:{id:"_2-现状与挑战"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-现状与挑战"}},[a._v("#")]),a._v(" 2. 现状与挑战")]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("入口混乱")]),a._v("：多个网关共存，鉴权、限流策略重复维护。")]),a._v(" "),s("li",[s("strong",[a._v("服务发现割裂")]),a._v("：REST、gRPC、MQTT 不同协议各自实现注册中心，导致拓扑不可视。")]),a._v(" "),s("li",[s("strong",[a._v("治理策略缺乏闭环")]),a._v("：熔断、限流策略配置后缺少监控验证。")])]),a._v(" "),s("h2",{attrs:{id:"_3-治理全景图"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-治理全景图"}},[a._v("#")]),a._v(" 3. 治理全景图")]),a._v(" "),s("div",{staticClass:"language-mermaid line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-mermaid"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("graph")]),a._v(" LR\n    Client "),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[a._v("--\x3e")]),a._v(" APIGateway\n    APIGateway "),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[a._v("--\x3e")]),a._v(" AuthCenter\n    APIGateway "),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[a._v("--\x3e")]),a._v(" RateLimiter\n    APIGateway "),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[a._v("--\x3e")]),a._v(" ServiceMesh\n    ServiceMesh "),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[a._v("--\x3e")]),a._v(" ServiceRegistry\n    ServiceMesh "),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[a._v("--\x3e")]),a._v(" Observability\n    Observability "),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[a._v("--\x3e")]),a._v(" GovernancePortal\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("h2",{attrs:{id:"_4-核心能力拆解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-核心能力拆解"}},[a._v("#")]),a._v(" 4. 核心能力拆解")]),a._v(" "),s("ol",[s("li",[s("strong",[a._v("统一入口")]),a._v("：API Gateway（Kong, APISIX, Spring Cloud Gateway）负责协议适配、鉴权、灰度。")]),a._v(" "),s("li",[s("strong",[a._v("服务注册发现")]),a._v("：使用 Nacos/Consul/Etcd，结合 Sidecar 或 SDK 模式。")]),a._v(" "),s("li",[s("strong",[a._v("流量治理")]),a._v("：熔断、限流、降级、重试策略统一管控，支持可视化配置。")]),a._v(" "),s("li",[s("strong",[a._v("配置中心")]),a._v("：动态下发规则，支持灰度发布与回滚。")]),a._v(" "),s("li",[s("strong",[a._v("安全合规")]),a._v("：集成 WAF、数据脱敏、审计日志。")])]),a._v(" "),s("h2",{attrs:{id:"_5-架构落地步骤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-架构落地步骤"}},[a._v("#")]),a._v(" 5. 架构落地步骤")]),a._v(" "),s("h3",{attrs:{id:"_5-1-梳理入口策略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-梳理入口策略"}},[a._v("#")]),a._v(" 5.1 梳理入口策略")]),a._v(" "),s("ul",[s("li",[a._v("接管所有外部调用，划分“公开 API”“合作方 API”“内部 API”。")]),a._v(" "),s("li",[a._v("针对合作方引入签名校验、IP 白名单。")])]),a._v(" "),s("h3",{attrs:{id:"_5-2-网关与服务网格协同"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-网关与服务网格协同"}},[a._v("#")]),a._v(" 5.2 网关与服务网格协同")]),a._v(" "),s("ul",[s("li",[a._v("网关负责南北向流量，Service Mesh（Istio/Linkerd）负责东西向治理。")]),a._v(" "),s("li",[a._v("在网关处注入 TraceID，Mesh 透传，实现端到端链路。")]),a._v(" "),s("li",[a._v("Mesh 提供细粒度熔断与流量镜像能力。")])]),a._v(" "),s("h3",{attrs:{id:"_5-3-策略编排与监控"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-策略编排与监控"}},[a._v("#")]),a._v(" 5.3 策略编排与监控")]),a._v(" "),s("ul",[s("li",[a._v("建立治理门户，支持蓝图配置与审批。")]),a._v(" "),s("li",[a._v("引入 Prometheus + Grafana 监控治理策略命中率、熔断次数。")]),a._v(" "),s("li",[a._v("与业务指标联动，判断治理策略是否影响关键 KPI。")])]),a._v(" "),s("h2",{attrs:{id:"_6-业务实践案例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-业务实践案例"}},[a._v("#")]),a._v(" 6. 业务实践案例")]),a._v(" "),s("p",[a._v("在支付清结算平台：")]),a._v(" "),s("ul",[s("li",[a._v("使用 APISIX + etcd 构建统一网关，提供 JWT 鉴权与限流。")]),a._v(" "),s("li",[a._v("使用 Istio 连接内部服务，实现多版本灰度发布。")]),a._v(" "),s("li",[a._v("构建治理中台，支持策略模板化复用，运营人员无需修改配置文件。")])]),a._v(" "),s("h2",{attrs:{id:"_7-源码示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-源码示例"}},[a._v("#")]),a._v(" 7. 源码示例")]),a._v(" "),s("p",[a._v("以 Kong 为例配置限流与金丝雀：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" POST http://kong-admin:8001/services "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--data")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("settlement "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--data")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("url")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("http://settlement.svc.cluster.local:8080\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" POST http://kong-admin:8001/services/settlement/routes "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--data")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("settlement-route "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--data")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"paths[]=/settlement"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--data")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("strip_path")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("false\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" POST http://kong-admin:8001/services/settlement/plugins "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--data")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("rate-limiting "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--data")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("config.minute")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("600")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--data")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("config.policy")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("redis\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br")])]),s("h2",{attrs:{id:"_8-未来演进"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-未来演进"}},[a._v("#")]),a._v(" 8. 未来演进")]),a._v(" "),s("ul",[s("li",[a._v("引入 Gateway API，支持多团队协作。")]),a._v(" "),s("li",[a._v("结合 Open Policy Agent 实现细粒度访问控制。")]),a._v(" "),s("li",[a._v("将治理策略纳入 GitOps 流程，实现审计与回滚。")])]),a._v(" "),s("h2",{attrs:{id:"_9-参考资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-参考资料"}},[a._v("#")]),a._v(" 9. 参考资料")]),a._v(" "),s("ul",[s("li",[a._v("[Netflix: Microservices @ Scale]")]),a._v(" "),s("li",[a._v("[Apache APISIX 文档]")]),a._v(" "),s("li",[a._v("[Istio Traffic Management Guide]")])]),a._v(" "),s("p",[a._v("通过构建统一的微服务治理体系，可以提升平台稳定性，增强对业务风险的可控能力，并让团队更快响应市场变化。")])])}),[],!1,null,null,null);s.default=r.exports}}]);