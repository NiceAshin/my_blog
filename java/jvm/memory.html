<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JVM的运行时内存区域 | AshinBlog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="黑夜中前行，仍照亮前路!">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.e853742c.css" as="style"><link rel="preload" href="/assets/js/app.bb57ff9a.js" as="script"><link rel="preload" href="/assets/js/3.a30b6709.js" as="script"><link rel="preload" href="/assets/js/1.cca03dd0.js" as="script"><link rel="preload" href="/assets/js/93.d4669ef0.js" as="script"><link rel="prefetch" href="/assets/js/10.69e1aa51.js"><link rel="prefetch" href="/assets/js/100.a8f1ee96.js"><link rel="prefetch" href="/assets/js/101.9d567414.js"><link rel="prefetch" href="/assets/js/102.d1452359.js"><link rel="prefetch" href="/assets/js/103.740971e5.js"><link rel="prefetch" href="/assets/js/104.352bcdd6.js"><link rel="prefetch" href="/assets/js/105.8ef6c086.js"><link rel="prefetch" href="/assets/js/106.4f818e1a.js"><link rel="prefetch" href="/assets/js/107.559970d2.js"><link rel="prefetch" href="/assets/js/108.ab661542.js"><link rel="prefetch" href="/assets/js/109.39ff50ea.js"><link rel="prefetch" href="/assets/js/11.1b086bd8.js"><link rel="prefetch" href="/assets/js/110.341ee937.js"><link rel="prefetch" href="/assets/js/111.9f3fb1fc.js"><link rel="prefetch" href="/assets/js/112.022aa5dc.js"><link rel="prefetch" href="/assets/js/113.2aab82ec.js"><link rel="prefetch" href="/assets/js/114.5dd93947.js"><link rel="prefetch" href="/assets/js/115.ee1e0532.js"><link rel="prefetch" href="/assets/js/116.175f92bc.js"><link rel="prefetch" href="/assets/js/117.c88a30b8.js"><link rel="prefetch" href="/assets/js/118.7df9933d.js"><link rel="prefetch" href="/assets/js/119.07ea429a.js"><link rel="prefetch" href="/assets/js/12.dffcb3b7.js"><link rel="prefetch" href="/assets/js/120.e9836657.js"><link rel="prefetch" href="/assets/js/121.b81edf9b.js"><link rel="prefetch" href="/assets/js/122.51e43e7d.js"><link rel="prefetch" href="/assets/js/123.11bbdd7c.js"><link rel="prefetch" href="/assets/js/124.eeed61d1.js"><link rel="prefetch" href="/assets/js/125.4ae9b36f.js"><link rel="prefetch" href="/assets/js/126.fcf5a5af.js"><link rel="prefetch" href="/assets/js/127.a603163c.js"><link rel="prefetch" href="/assets/js/128.3d9a6c65.js"><link rel="prefetch" href="/assets/js/129.68e55c2f.js"><link rel="prefetch" href="/assets/js/13.c87ec0d4.js"><link rel="prefetch" href="/assets/js/130.103caf73.js"><link rel="prefetch" href="/assets/js/131.bf64f35f.js"><link rel="prefetch" href="/assets/js/132.319875d9.js"><link rel="prefetch" href="/assets/js/133.69881e20.js"><link rel="prefetch" href="/assets/js/134.6b9b54c2.js"><link rel="prefetch" href="/assets/js/14.ddf6b8b5.js"><link rel="prefetch" href="/assets/js/15.5359191f.js"><link rel="prefetch" href="/assets/js/16.1a0014c4.js"><link rel="prefetch" href="/assets/js/17.18d7c26b.js"><link rel="prefetch" href="/assets/js/18.97d1737b.js"><link rel="prefetch" href="/assets/js/19.83603dba.js"><link rel="prefetch" href="/assets/js/20.b9bd7960.js"><link rel="prefetch" href="/assets/js/21.1c57980d.js"><link rel="prefetch" href="/assets/js/22.fd6935f6.js"><link rel="prefetch" href="/assets/js/23.a13fd506.js"><link rel="prefetch" href="/assets/js/24.c8c53d68.js"><link rel="prefetch" href="/assets/js/25.ddff5762.js"><link rel="prefetch" href="/assets/js/26.02ddae21.js"><link rel="prefetch" href="/assets/js/27.362c51b6.js"><link rel="prefetch" href="/assets/js/28.dd12b3e6.js"><link rel="prefetch" href="/assets/js/29.6d6252bb.js"><link rel="prefetch" href="/assets/js/30.72b8c243.js"><link rel="prefetch" href="/assets/js/31.c5fd4a8b.js"><link rel="prefetch" href="/assets/js/32.d85e3431.js"><link rel="prefetch" href="/assets/js/33.eb02c4d3.js"><link rel="prefetch" href="/assets/js/34.9fcf3a56.js"><link rel="prefetch" href="/assets/js/35.493cb9fe.js"><link rel="prefetch" href="/assets/js/36.ddc4139b.js"><link rel="prefetch" href="/assets/js/37.5896d1ca.js"><link rel="prefetch" href="/assets/js/38.05c45e9d.js"><link rel="prefetch" href="/assets/js/39.f7e645e8.js"><link rel="prefetch" href="/assets/js/4.3808e766.js"><link rel="prefetch" href="/assets/js/40.071fbc1e.js"><link rel="prefetch" href="/assets/js/41.874656f9.js"><link rel="prefetch" href="/assets/js/42.ab33fbbd.js"><link rel="prefetch" href="/assets/js/43.8afd89bd.js"><link rel="prefetch" href="/assets/js/44.dc1daca4.js"><link rel="prefetch" href="/assets/js/45.32ce99c9.js"><link rel="prefetch" href="/assets/js/46.86e2edd8.js"><link rel="prefetch" href="/assets/js/47.cf6a45a1.js"><link rel="prefetch" href="/assets/js/48.33ad02a0.js"><link rel="prefetch" href="/assets/js/49.e3f07cd9.js"><link rel="prefetch" href="/assets/js/5.b659ac8f.js"><link rel="prefetch" href="/assets/js/50.44cf0c3c.js"><link rel="prefetch" href="/assets/js/51.ba7c8902.js"><link rel="prefetch" href="/assets/js/52.3914cb79.js"><link rel="prefetch" href="/assets/js/53.72dfe3fe.js"><link rel="prefetch" href="/assets/js/54.bf868281.js"><link rel="prefetch" href="/assets/js/55.0050143c.js"><link rel="prefetch" href="/assets/js/56.4b8a0053.js"><link rel="prefetch" href="/assets/js/57.c6162f9f.js"><link rel="prefetch" href="/assets/js/58.7dd6dff9.js"><link rel="prefetch" href="/assets/js/59.91fd2a15.js"><link rel="prefetch" href="/assets/js/6.82e5b679.js"><link rel="prefetch" href="/assets/js/60.81e59a18.js"><link rel="prefetch" href="/assets/js/61.36c57dbf.js"><link rel="prefetch" href="/assets/js/62.693063e7.js"><link rel="prefetch" href="/assets/js/63.6e08f720.js"><link rel="prefetch" href="/assets/js/64.dd52b51b.js"><link rel="prefetch" href="/assets/js/65.5104bb23.js"><link rel="prefetch" href="/assets/js/66.062455e7.js"><link rel="prefetch" href="/assets/js/67.28c57bb5.js"><link rel="prefetch" href="/assets/js/68.19b5630c.js"><link rel="prefetch" href="/assets/js/69.a4d9a9f3.js"><link rel="prefetch" href="/assets/js/7.1802b96c.js"><link rel="prefetch" href="/assets/js/70.9af7cf2a.js"><link rel="prefetch" href="/assets/js/71.20ede5ab.js"><link rel="prefetch" href="/assets/js/72.6d8e2045.js"><link rel="prefetch" href="/assets/js/73.ac30978d.js"><link rel="prefetch" href="/assets/js/74.951efe84.js"><link rel="prefetch" href="/assets/js/75.e5c3f364.js"><link rel="prefetch" href="/assets/js/76.27cf86a8.js"><link rel="prefetch" href="/assets/js/77.8c4c0354.js"><link rel="prefetch" href="/assets/js/78.151ec9e5.js"><link rel="prefetch" href="/assets/js/79.44946107.js"><link rel="prefetch" href="/assets/js/8.4b6e007f.js"><link rel="prefetch" href="/assets/js/80.8777d920.js"><link rel="prefetch" href="/assets/js/81.857b4f50.js"><link rel="prefetch" href="/assets/js/82.64d7b72e.js"><link rel="prefetch" href="/assets/js/83.a42c835a.js"><link rel="prefetch" href="/assets/js/84.016d560f.js"><link rel="prefetch" href="/assets/js/85.3403cbd5.js"><link rel="prefetch" href="/assets/js/86.59898fab.js"><link rel="prefetch" href="/assets/js/87.ba9a9d37.js"><link rel="prefetch" href="/assets/js/88.c325c789.js"><link rel="prefetch" href="/assets/js/89.c3fe56bd.js"><link rel="prefetch" href="/assets/js/9.86bf551b.js"><link rel="prefetch" href="/assets/js/90.176a16c9.js"><link rel="prefetch" href="/assets/js/91.3897db10.js"><link rel="prefetch" href="/assets/js/92.778b9b6a.js"><link rel="prefetch" href="/assets/js/94.6aaa086e.js"><link rel="prefetch" href="/assets/js/95.66b8e863.js"><link rel="prefetch" href="/assets/js/96.eca88322.js"><link rel="prefetch" href="/assets/js/97.a0d1bdf0.js"><link rel="prefetch" href="/assets/js/98.58ea5755.js"><link rel="prefetch" href="/assets/js/99.513ff1d6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e853742c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>AshinBlog</h3> <p class="description" data-v-59e6cb88>黑夜中前行，仍照亮前路!</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>AshinZhang</span>
          
        <span data-v-59e6cb88>2020 - </span>
        2026
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="AshinBlog" class="logo"> <span class="site-name">AshinBlog</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      架构与设计思想
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ddd/" class="nav-link"><i class="undefined"></i>
  领域驱动设计
</a></li><li class="dropdown-item"><!----> <a href="/microservice/" class="nav-link"><i class="undefined"></i>
  微服务实践
</a></li><li class="dropdown-item"><!----> <a href="/design/" class="nav-link"><i class="undefined"></i>
  设计模式手册
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      编程语言与响应式开发
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/" class="nav-link router-link-active"><i class="undefined"></i>
  Java 技术栈
</a></li><li class="dropdown-item"><!----> <a href="/go/" class="nav-link"><i class="undefined"></i>
  Go 语言
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      平台工程与基础设施
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docker/" class="nav-link"><i class="undefined"></i>
  Docker 入门与部署
</a></li><li class="dropdown-item"><!----> <a href="/cloud-native/" class="nav-link"><i class="undefined"></i>
  云原生实践
</a></li><li class="dropdown-item"><!----> <a href="/ground/" class="nav-link"><i class="undefined"></i>
  中间件运维
</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link"><i class="undefined"></i>
  Linux 运维手册
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      AI 与智能工具
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ai/" class="nav-link"><i class="undefined"></i>
  AI 实践
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      工程实战与知识库
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/more/#问题排查与经验" class="nav-link"><i class="undefined"></i>
  问题排查与经验
</a></li><li class="dropdown-item"><!----> <a href="/more/#项目与配置实战" class="nav-link"><i class="undefined"></i>
  项目与配置实战
</a></li><li class="dropdown-item"><!----> <a href="/more/#接口文档专区" class="nav-link"><i class="undefined"></i>
  接口文档专区
</a></li></ul></div></div> <a href="https://github.com/NiceAshin" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="/avatar.png" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    AshinZhang
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>119</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>35</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      架构与设计思想
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ddd/" class="nav-link"><i class="undefined"></i>
  领域驱动设计
</a></li><li class="dropdown-item"><!----> <a href="/microservice/" class="nav-link"><i class="undefined"></i>
  微服务实践
</a></li><li class="dropdown-item"><!----> <a href="/design/" class="nav-link"><i class="undefined"></i>
  设计模式手册
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      编程语言与响应式开发
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/" class="nav-link router-link-active"><i class="undefined"></i>
  Java 技术栈
</a></li><li class="dropdown-item"><!----> <a href="/go/" class="nav-link"><i class="undefined"></i>
  Go 语言
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      平台工程与基础设施
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docker/" class="nav-link"><i class="undefined"></i>
  Docker 入门与部署
</a></li><li class="dropdown-item"><!----> <a href="/cloud-native/" class="nav-link"><i class="undefined"></i>
  云原生实践
</a></li><li class="dropdown-item"><!----> <a href="/ground/" class="nav-link"><i class="undefined"></i>
  中间件运维
</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link"><i class="undefined"></i>
  Linux 运维手册
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      AI 与智能工具
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ai/" class="nav-link"><i class="undefined"></i>
  AI 实践
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      工程实战与知识库
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/more/#问题排查与经验" class="nav-link"><i class="undefined"></i>
  问题排查与经验
</a></li><li class="dropdown-item"><!----> <a href="/more/#项目与配置实战" class="nav-link"><i class="undefined"></i>
  项目与配置实战
</a></li><li class="dropdown-item"><!----> <a href="/more/#接口文档专区" class="nav-link"><i class="undefined"></i>
  接口文档专区
</a></li></ul></div></div> <a href="https://github.com/NiceAshin" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88></h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>AshinZhang</span>
          
        <span data-v-59e6cb88>2020 - </span>
        2026
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">JVM的运行时内存区域</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>AshinZhang</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>11/17/2023</span></i> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h1 id="jvm的运行时内存区域"><a href="#jvm的运行时内存区域" class="header-anchor">#</a> JVM的运行时内存区域</h1> <blockquote><p>预计阅读时间：20 分钟</p></blockquote> <p><img src="https://cdn.jsdelivr.net/gh/NiceAshin/FileStore/blogImage/jvm-memory.png" alt="jvm-memory"></p> <h2 id="程序计数器"><a href="#程序计数器" class="header-anchor">#</a> 程序计数器</h2> <p>程序计数器是线程私有的, 它可以看作是当前线程所执行字节码的行号指示器, 执行引擎通过改变这个计数器的值来选取下一条需要执行的字节码指令. 它用于多线程切换后能够恢复到正确的执行位置.</p> <h2 id="虚拟机栈"><a href="#虚拟机栈" class="header-anchor">#</a> 虚拟机栈</h2> <p>虚拟机栈描述的是java方法执行的内存模型, 栈是线程私有的, 线程中每个方法执行的时候会压入一个栈帧, 用于存储局部变量表, 操作数栈, 动态连接(指向运行时常量池的方法引用), 方法出口(正常退出或异常推出)等信息.</p> <p><img src="http://image.ytg2097.com/stack.jpg" alt="stack"></p> <h3 id="_1-局部变量表"><a href="#_1-局部变量表" class="header-anchor">#</a> 1. 局部变量表</h3> <p>定义为一个数字数组, 用于存储方法参数和定义在方法体内部的局部变量, 这些数据类型包括各类基本数据类型, 对象的引用以及returnAddress类型.</p> <p>局部变量表的大小在编译器确定下来, 并保存在方法的Code属性的maximum local variables数据项中.</p> <p>局部变量表数组中的每个格子称之为Slot, 每个局部变量都会按照顺序复制到每一个Slot上, 每个Slot都有一个访问索引, 通过这个索引可以访问到局部变量表中的局部变量值.</p> <p>32位以内的类型只占用一个slot, 64位的占用两个.</p> <p>非静态方法的局部变量表的index为0的位置会放置this引用.</p> <p><img src="https://cdn.jsdelivr.net/gh/NiceAshin/FileStore/blogImage/lvt.png" alt="lvt"></p> <p>在以可达性算法实现的垃圾回收器中, 局部变量表中的变量也是垃圾回收的根节点之一. 被直接或间接引用的对象都不会被回收.</p> <p>局部变量表的大小会直接影响整个栈帧的大小, 进而也会影响栈可容纳栈帧的数量</p> <hr> <h3 id="_2-操作数栈"><a href="#_2-操作数栈" class="header-anchor">#</a> 2. 操作数栈</h3> <p>操作数栈是基于数组实现的.</p> <p>操作数栈在方法执行过程中, 根据字节码指令, 往栈中写入或提取数据, 即入栈和出栈.</p> <p>操作数栈主要用于保存计算过程的中间结果, 同时作为计算过程中变量的临时的存储空间, 如果被调用的方法带有返回值, 返回值将会被压入当前栈帧的操作数栈中, 并更新程序计数器中下一条需要执行的字节码指令.</p> <hr> <h3 id="_3-动态链接"><a href="#_3-动态链接" class="header-anchor">#</a> 3. 动态链接</h3> <p>每个栈帧都是一个方法, 而方法是保存在方法区中的运行时常量池中的. 动态链接就是栈帧中指向运行时常量池中对应方法的引用. 这个引用的作用是为了支持当前方法的代码能够实现动态链接. 比如invokedynamic指令.</p> <div class="custom-block tip"><p class="title">Tip</p><p>当java文件编译为字节码文件时, 所有的变量和方法引用都作为符号引用保存在class文件的常量池中, 在类加载的解析过程中, 这些符号引用就被解析为了直接引用.
当一个方法调用另一个方法时, 就是通过常量池中指向方法的符号引用来表示的.
动态链接的作用就是为了将这些符号引用转换为调用方法的直接引用.</p></div><p>除动态链接以外, 还有<strong>静态链接</strong>.</p> <div class="language- extra-class"><pre><code>当一个字节码文件被加载到JVM内部时, 如果被调用的方法在编译器可知且运行期间保持不变时, 
这种情况下将调用方法的符号引用转换为直接引用的过程称之为静态链接. 

如果被调用的方法在编译器无法确定下来, 也就是说, 只能够在程序运行期间将调用方法的符号
应用转换为直接引用, 由于这种引用转换过程具备动态性, 因此称之为动态链接. 
</code></pre></div><p>动态链接与静态链接的方法绑定机制也不同, 绑定是一个字段, 方法或类在符号引用被替换为直接引用的过程.
动态链接的方法绑定为晚期绑定, 而静态链接的方法绑定为早期绑定.</p> <p>早期绑定指被调用方法在编译器可知, 且运行期间不变即可将这个方法与所属类型绑定.
晚期绑定指被调用方法编译器无法确定, 只能在程序运行期间根据实际类型绑定相关方法. 这类方法也被称为<strong>虚方法</strong>.
与之相对的早期绑定的方法即<strong>非虚方法</strong>.</p> <hr> <h3 id="_4-虚拟机中提供的方法调用指令"><a href="#_4-虚拟机中提供的方法调用指令" class="header-anchor">#</a> 4. 虚拟机中提供的方法调用指令</h3> <p><img src="https://cdn.jsdelivr.net/gh/NiceAshin/FileStore/blogImage/invokevirtual.png" alt="invoke"></p> <ul><li><p><strong>普通调用指令</strong>:</p> <ol><li>invokestatic: 调用静态方法</li> <li>invokespecial: 调用&lt;init&gt;方法, 私有方法, 父类方法(super)</li> <li>invokevirtual: 调用所有虚方法, 包括final修饰方法</li> <li>invokeinterface: 调用接口方法</li></ol></li> <li><p><strong>动态调用指令</strong>:</p> <ol><li>invokedynamic: 动态解析出需要调用的方法, 然后执行</li></ol></li></ul> <p>普通调用指令固化在虚拟机内部, 不可人为干预, 动态调用指令则可以由程序员使用, 如使用ASM</p> <h3 id="_5-方法返回地址"><a href="#_5-方法返回地址" class="header-anchor">#</a> 5. 方法返回地址</h3> <p>方法返回地址保存的是程序计数器的值, 也就是调用该方法的指令的下一条指令的地址</p> <h2 id="本地方法栈"><a href="#本地方法栈" class="header-anchor">#</a> 本地方法栈</h2> <p>本地方法栈与虚拟机栈相似, 也是线程私有的, 里面的栈帧是虚拟机使用到的native方法服务</p> <h2 id="堆"><a href="#堆" class="header-anchor">#</a> 堆</h2> <p>jvm的堆内存是线程共享的, 用于存放对象实例, 是垃圾收集器管理的主要收集区域, 由于垃圾收集器采用分代算法, 所以堆又分为新生代与老年代.</p> <p><img src="https://cdn.jsdelivr.net/gh/NiceAshin/FileStore/blogImage/heap.png" alt="heap"></p> <p>新生代的Eden与From和To(两个Survivor)之间的大小比例默认为8:1:1, 新生代与老年代的大小比例默认为1:2.</p> <h3 id="对象内存分配"><a href="#对象内存分配" class="header-anchor">#</a> 对象内存分配</h3> <p><img src="http://image.ytg2097.com/obj-allc.png" alt="对象分配"></p> <p>新对象<strong>大部分</strong> 分配到新生代的Eden区, 当新生代的Eden没有足够空间时会触发一次youngGC, 回收在Eden与From区中可达性分析中判断为可回收的对象, 如果对象本次不可回收将会移动到To区中. 然后对象的GC年龄+1. 同时
回收Eden与From区中的垃圾对象. 如果在迁移到To区时, To区空间不足, 则会直接进入老年代. 老年代空间不足时会触发FullGC</p> <blockquote><p>ps: 这里有个问题算是扩展思考,  youngGC的时候, Eden和From区的不可回收对象要迁移到To区, 如果To区空间不足就要直接晋升到老年代, 这个晋升时Eden和From的不可回收对象全部晋升, 还是部分晋升? 如果是部分晋升的话是依据什么条件, 对象年龄排序吗?</p> <p>其实这个问题, JVM已经提前解决了, 详见下面的<strong>空间分配担保</strong></p></blockquote> <p>若对象长期存活(对象的GC年龄达到15)会晋升入老年代, <strong>大对象</strong>分配时则会直接进入老年代(大对象应该尽量避免).</p> <div class="custom-block tip"><p class="title">大对象</p><p>youngGC后, Eden区为空, 此时分配对象大小若大于Eden区大小, 则会判定为大对象, 直接进入老年代.</p></div><div class="custom-block tip"><p class="title">动态对象年龄判定</p><p>若Survivor中相同年龄的对象大小总和达到了Survivor空间的一半, 那么大于等于这个年龄的对象将直接进入老年代. 若老年代还是不够, 则FullGC, 若还不够则OOM.</p></div><div class="custom-block tip"><p class="title">空间分配担保</p><p>youngGC之前会检查老年代最大可用连续空间是否大于新生代所有对象总空间, 若条件成立, 直接GC; 不成立, 会检查老年代最大可用连续空间是否大于历次晋升到老年代的对象的平均大小, 条件成立时,
尝试进行youngGC, 不成立则进行FullGC</p></div><h3 id="tlab"><a href="#tlab" class="header-anchor">#</a> TLAB</h3> <p>由于堆空间是线程共享的, 且对象创建的操作是非常频繁的, 因此在并发情况下在堆中分配对象空间是线程不安全的, 为了避免多线程操作同一个地址, 就需要使用加锁等机制来保证线程安全, 但同时也影响了分配的速度.</p> <p>TLAB(Thread Local Allocation Buffer)是java内存模型中的一部分, JVM在Eden中为每个线程分配一个线程的私有缓存区域, 当多线程并发分配内存时使用TLAB来避免并发问题. 如果TLAB分配失败, 则使用加锁机制确保内存分配的原子性</p> <h4 id="逃逸分析与栈上分配"><a href="#逃逸分析与栈上分配" class="header-anchor">#</a> 逃逸分析与栈上分配</h4> <p>TLAB技术并不是只解决多线程并发分配内存的问题, 还可以搭配逃逸分析与栈上分配来降低GC的回收频率和提高GC的回收效率.</p> <p>判断发生逃逸的依据有两种, 一种是相对于栈帧的: <strong>判断new的对象是否有在方法的外部使用.</strong> 这种情况是对象在一个栈帧的生命周期中进行实例化操作之后要依靠堆去共享给其他栈帧使用.
另外一种是相对于线程的: <strong>new的对象被赋值给了堆中的对象的成员变量或类的成员变量.</strong>
因为对象被放入堆中后, 可以被其他线程访问. 以上两种情况对于new的对象的之后的使用情况, 编译器是无法追踪的. 所以视为逸出.</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token comment">// obj没有返回出去, 所以没有发生逃逸</span>
        <span class="token class-name">Object</span>  obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token comment">// obj被return出去, 发生了逃逸</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">Object</span> obj<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setObj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        
        <span class="token comment">// new出来的obj可能会在外部调用, 发生了逃逸</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token comment">// obj被return出去, 发生了逃逸</span>
        <span class="token keyword">return</span> obj <span class="token operator">==</span> <span class="token keyword">null</span><span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> obj<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        
        <span class="token comment">//也是发生了逃逸, 判断逃逸的标准并不是只看当前方法, </span>
        <span class="token comment">//如果使用了已逃逸都算做发生逃逸</span>
        <span class="token class-name">Object</span> o <span class="token operator">=</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    
        <span class="token comment">// 锁仅当前线程可见, 对象是没有逃逸的</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h4 id="同步省略"><a href="#同步省略" class="header-anchor">#</a> 同步省略</h4> <p>当逃逸分析一个对象没有逸出方法时, 可能会被优化为栈上分配. <strong>同时如果JIT编译器在通过逃逸分析判断同步代码块所使用的监视器对象只被一个线程访问</strong>, 上面实例代码中的test5, 那么JIT会在编译时取消
这个同步代码块来提高并发性能, 因为它是没有意义的加锁. 这个取消的过程就叫做同步省略.</p> <h4 id="标量替换"><a href="#标量替换" class="header-anchor">#</a> 标量替换</h4> <p>对于没有逃逸的对象来说, 如果满足特定条件, JIT编译器还会进行标量替换来进一步优化.</p> <p>标量指的是不可以在分解成更小的数据的数据. java中的标量是基本类型. 与标量相对的是聚合量. 也就是还可以再拆分的数据. java中的对象就是聚合量. 标量替换就是将聚合量拆分为标量的过程.</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    
    <span class="token keyword">class</span> <span class="token class-name">Obj</span><span class="token punctuation">{</span>
        <span class="token keyword">int</span> a<span class="token punctuation">;</span>
        <span class="token keyword">int</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 替换前</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">beforeScalarReplice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    
        <span class="token class-name">Obj</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Obj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        obj<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 替换后</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">beforeScalarReplice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    
        <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
     
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><hr> <p><img src="https://cdn.jsdelivr.net/gh/NiceAshin/FileStore/blogImage/obj-allc-flow.png" alt="对象分配过程"></p> <h3 id="对象创建过程"><a href="#对象创建过程" class="header-anchor">#</a> 对象创建过程</h3> <ol><li>虚拟机遇到new命令时, 首先检查这个指令的参数是否能在常量池定位到一个类的符号引用, 并检查这个符号引用代表的类是否已经被加载, 解析和初始化过.</li> <li>分配内存. 对象所需内存的大小在类加载时就已经确定</li> <li>初始化分配的内存空间为零值.</li> <li>虚拟机对对象进行必要的设置. 例如这个对象是哪个类的实例, 如何才能找到对象的元数据信息, 对象的哈希码, 对象的GC分代年龄等信息. 这些信息保存在对象头中</li> <li>对于虚拟机来说, 前四步已经完成了对象的创建. 执行init方法, 也就是下面的六七两步</li> <li>进行对象属性的显式初始化, 包括构造代码块中的初始化, 这两个的顺序是代码编写的前后顺序</li> <li>执行构造方法</li></ol> <h3 id="对象的内存布局"><a href="#对象的内存布局" class="header-anchor">#</a> 对象的内存布局</h3> <ul><li><strong>对象头</strong></li></ul> <p>存储对象自身的运行时数据. 如哈希码, GC分代年龄, 锁状态标志, 偏向线程ID, 偏向时间戳等.</p> <p>存储类型指针, 即对象指向他的类元数据的指针, 虚拟机通过这个指针来确定这个对象是哪个类的实例(并不是所有虚拟机都这么做), 若对象是数组, 对象头中还需要一块用于记录数组的长度</p> <ul><li><strong>实例数据</strong></li></ul> <p>对象真正存储的有效信息, 字段内容, 包括继承的.</p> <ul><li><strong>对齐填充</strong></li></ul> <p>由于hotspot的自动内存管理系统要求对象的大小必须是8字节的整数倍, 而对象头部分正好是8字节的整数倍, 因此, 当实例数据没有对齐时, 需要对齐填充来补全.</p> <h3 id="对象的访问定位"><a href="#对象的访问定位" class="header-anchor">#</a> 对象的访问定位</h3> <p>java程序通过栈上的reference数据来操作堆上的具体对象, 但虚拟机规范并没有定义这个引用应该通过何种方式去访问堆中的对象, 现在的访问方式有两种:</p> <ul><li><strong>句柄</strong></li></ul> <p>堆中划分出一块内存作为句柄池, reference中存储的是对象句柄的地址.</p> <p>句柄中包含对象实例和类型数据各自的具体地址信息.</p> <p>好处是当对象被移动时, 只会改变句柄中的实例数据指针, reference本身不需要修改.</p> <ul><li><strong>直接指针</strong></li></ul> <p>reference中直接存储对象地址, 好处是访问速度快.</p> <h2 id="方法区"><a href="#方法区" class="header-anchor">#</a> 方法区</h2> <p>方法区域与堆一样是线程共享的, 用于存储虚拟机加载的Class信息, 常量, JIT编译器编译后的代码.</p> <p>方法区又称为永久代, 原因是hotspot虚拟机将GC分代回收扩展至方法区, 或者说使用永久代实现方法区, 目的是让垃圾回收器可以向管理堆一样管理方法区.</p> <p>在jdk7中, 永久代中的字符串常量池和静态变量迁移到了堆中, 在jdk8开始, 永久代被元空间替换, 所在位置转移到了本地内存中.</p> <h3 id="为什么替换为元空间"><a href="#为什么替换为元空间" class="header-anchor">#</a> 为什么替换为元空间</h3> <ol><li>永久代大小很难确定不好设置</li></ol> <p>某些场景下, 如果动态加载类过多, 容易产生永久代的oom, 比如某个web工程中, 因为功能点比较多, 在运行过程中, 要不断动态加载很多类, 会出现永久代的oom</p> <p>而元空间因为不在虚拟机中, 使用的是本地内存, 因此默认情况下, 元空间的大小仅受本地内存限制.</p> <ol start="2"><li>永久代调优困难</li></ol> <p>针对jvm的调优一般都是针对于full gc的.</p> <p>针对于方法区的回收, 主要是回收常量池中废弃的常量和不再使用的类型. 回收类型之前首先要判断这个类是否已经不再使用, 而判断类型是否不再使用的条件比较苛刻, 且比较耗时.</p> <p>将方法区替换到本地内存中也能够减少full gc的次数。</p> <h3 id="字符串常量池为什么要迁移到堆中"><a href="#字符串常量池为什么要迁移到堆中" class="header-anchor">#</a> 字符串常量池为什么要迁移到堆中</h3> <p>字符串常量池是在jdk7中和静态变量一块迁移到堆空间中的， 那时还没有替换为元空间。 之所以迁移到堆中也是因为永久代的回收效率太低, 放到堆中方便及时回收.</p> <h3 id="运行时常量池与字符串常量池的区别"><a href="#运行时常量池与字符串常量池的区别" class="header-anchor">#</a> 运行时常量池与字符串常量池的区别</h3> <p>运行时常量池位于元空间内, 用于存放编译器生成的各种字面量和符号引用, 这部分内容在类加载后进入方法区的运行时常量池.</p> <p>运行时常量池在jdk1.7之前是包含字符串常量池(StringTable)的, jdk7开始, 由于字符串常量池迁移到堆中, 两者分开.</p> <div class="custom-block tip"><p class="title">字面量</p><p>文本字符串, 声明为final的常量值</p></div><div class="custom-block tip"><p class="title">符号引用</p><ul><li>类和接口的完全限定名</li> <li>字段的名称和描述符</li> <li>方法的名称和描述符</li></ul></div><h2 id="内存溢出"><a href="#内存溢出" class="header-anchor">#</a> 内存溢出</h2> <p>内存溢出与内存泄露的区别: 内存溢出程序运行过程中申请的内存大于系统能够提供的内存, 导致无法申请到足够的内存, 于是发生内存溢出. 内存泄露指程序运行过程中分配内存给临时变量, 用完之后却没有GC回收, 始终占用着内存,
既不能被使用也不能分配给其他程序.</p> <p>下面记录了几种内存溢出的排查与解决方法</p> <ul><li><strong>堆上的内存溢出</strong></li></ul> <p>使用内存映像工具对dump出的堆转储快照进行分析, 确认内存中的对象是否必要, 也就是先分清楚是出现了内存泄露还是内存溢出.</p> <p>如果是内存泄露, 查看泄露对象到GC Roots的引用链.</p> <p>如果不存在内存泄露, 检查堆参数与物理机器对比是否还可以调大, 再检查代码是否某些对象的生命周期过长, 持有状态时间过长.
https://github.com/roncoo/roncoo-education-web.git</p> <ul><li><strong>栈上的内存溢出</strong></li></ul> <p>主要检查多线程时的溢出, 虚拟机内存排除掉堆和方法区后, 每个线程分配到的栈容量越大, 可以创建的线程数量越少, 创建线程时越容易把剩下的内存耗尽.</p> <ul><li><strong>方法区的内存溢出</strong></li></ul> <p>在经常动态生成大量class的应用中, 需要特别注意类的回收状况.</p> <p>如果是JSP或动态生成JSP的应用同上.</p></div></section> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/NiceAshin/edit/master/my_blog/java/jvm/memory.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">2/27/2026, 7:33:24 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/java/jvm/class-load.html" class="prev">
          类加载
        </a></span> <span class="next"><a href="/java/jvm/gc.html">
          GC
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/java/jvm/memory.html#程序计数器" class="sidebar-link reco-side-程序计数器" data-v-b57cc07c>程序计数器</a></li><li class="level-2" data-v-b57cc07c><a href="/java/jvm/memory.html#虚拟机栈" class="sidebar-link reco-side-虚拟机栈" data-v-b57cc07c>虚拟机栈</a></li><li class="level-3" data-v-b57cc07c><a href="/java/jvm/memory.html#_1-局部变量表" class="sidebar-link reco-side-_1-局部变量表" data-v-b57cc07c>1. 局部变量表</a></li><li class="level-3" data-v-b57cc07c><a href="/java/jvm/memory.html#_2-操作数栈" class="sidebar-link reco-side-_2-操作数栈" data-v-b57cc07c>2. 操作数栈</a></li><li class="level-3" data-v-b57cc07c><a href="/java/jvm/memory.html#_3-动态链接" class="sidebar-link reco-side-_3-动态链接" data-v-b57cc07c>3. 动态链接</a></li><li class="level-3" data-v-b57cc07c><a href="/java/jvm/memory.html#_4-虚拟机中提供的方法调用指令" class="sidebar-link reco-side-_4-虚拟机中提供的方法调用指令" data-v-b57cc07c>4. 虚拟机中提供的方法调用指令</a></li><li class="level-3" data-v-b57cc07c><a href="/java/jvm/memory.html#_5-方法返回地址" class="sidebar-link reco-side-_5-方法返回地址" data-v-b57cc07c>5. 方法返回地址</a></li><li class="level-2" data-v-b57cc07c><a href="/java/jvm/memory.html#本地方法栈" class="sidebar-link reco-side-本地方法栈" data-v-b57cc07c>本地方法栈</a></li><li class="level-2" data-v-b57cc07c><a href="/java/jvm/memory.html#堆" class="sidebar-link reco-side-堆" data-v-b57cc07c>堆</a></li><li class="level-3" data-v-b57cc07c><a href="/java/jvm/memory.html#对象内存分配" class="sidebar-link reco-side-对象内存分配" data-v-b57cc07c>对象内存分配</a></li><li class="level-3" data-v-b57cc07c><a href="/java/jvm/memory.html#tlab" class="sidebar-link reco-side-tlab" data-v-b57cc07c>TLAB</a></li><li class="level-3" data-v-b57cc07c><a href="/java/jvm/memory.html#对象创建过程" class="sidebar-link reco-side-对象创建过程" data-v-b57cc07c>对象创建过程</a></li><li class="level-3" data-v-b57cc07c><a href="/java/jvm/memory.html#对象的内存布局" class="sidebar-link reco-side-对象的内存布局" data-v-b57cc07c>对象的内存布局</a></li><li class="level-3" data-v-b57cc07c><a href="/java/jvm/memory.html#对象的访问定位" class="sidebar-link reco-side-对象的访问定位" data-v-b57cc07c>对象的访问定位</a></li><li class="level-2" data-v-b57cc07c><a href="/java/jvm/memory.html#方法区" class="sidebar-link reco-side-方法区" data-v-b57cc07c>方法区</a></li><li class="level-3" data-v-b57cc07c><a href="/java/jvm/memory.html#为什么替换为元空间" class="sidebar-link reco-side-为什么替换为元空间" data-v-b57cc07c>为什么替换为元空间</a></li><li class="level-3" data-v-b57cc07c><a href="/java/jvm/memory.html#字符串常量池为什么要迁移到堆中" class="sidebar-link reco-side-字符串常量池为什么要迁移到堆中" data-v-b57cc07c>字符串常量池为什么要迁移到堆中</a></li><li class="level-3" data-v-b57cc07c><a href="/java/jvm/memory.html#运行时常量池与字符串常量池的区别" class="sidebar-link reco-side-运行时常量池与字符串常量池的区别" data-v-b57cc07c>运行时常量池与字符串常量池的区别</a></li><li class="level-2" data-v-b57cc07c><a href="/java/jvm/memory.html#内存溢出" class="sidebar-link reco-side-内存溢出" data-v-b57cc07c>内存溢出</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.bb57ff9a.js" defer></script><script src="/assets/js/3.a30b6709.js" defer></script><script src="/assets/js/1.cca03dd0.js" defer></script><script src="/assets/js/93.d4669ef0.js" defer></script>
  </body>
</html>
